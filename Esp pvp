-- BRM5 v6.5 by DEXTER
-- PHƯƠNG PHÁP ÉP HIỂN THỊ TRỰC TIẾP (NO FRAME)
-- LOGIC: ESP TỰ XÓA KHI CHẾT, TỰ HIỆN KHI HỒI SINH

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

local Settings = {
    ESP = false,
    Recoil = false
}

local Tracked = {}

-- --- LOGIC ESP ---
local function ClearESP(m)
    if Tracked[m] then
        pcall(function()
            if Tracked[m].B then Tracked[m].B:Destroy() end
            if Tracked[m].C then Tracked[m].C:Disconnect() end
        end)
        Tracked[m] = nil
    end
end

local function MakeESP(m)
    if not m or Tracked[m] or not Settings.ESP then return end
    
    -- Kiểm tra mục tiêu (Male là NPC địch, Enemy là tên chung, hoặc Player khác)
    local isTarget = (m.Name == "Male" or m.Name == "Enemy" or (Players:GetPlayerFromCharacter(m) and m ~= LocalPlayer.Character))
    if not isTarget then return end

    local hum = m:FindFirstChildOfClass("Humanoid")
    local head = m:FindFirstChild("Head")

    if hum and head and hum.Health > 0 then
        local b = Instance.new("BoxHandleAdornment")
        b.Size = head.Size + Vector3.new(0.5, 0.5, 0.5)
        b.Adornee = head
        b.AlwaysOnTop = true
        b.ZIndex = 10
        b.Color3 = Color3.new(1, 0, 0) -- Màu đỏ
        b.Transparency = 0.5
        b.Parent = head

        local c = hum.Died:Connect(function() ClearESP(m) end)
        Tracked[m] = {B = b, C = c}
    end
end

-- Vòng lặp quét (Auto Respawn)
task.spawn(function()
    while true do
        task.wait(1)
        if Settings.ESP then
            for _, v in ipairs(Workspace:GetChildren()) do 
                if v:IsA("Model") then MakeESP(v) end 
            end
            for _, p in ipairs(Players:GetPlayers()) do 
                if p.Character then MakeESP(p.Character) end 
            end
        end
    end
end)

-- --- UI ÉP HIỂN THỊ (NẰM NGOÀI FRAME) ---
local gui = Instance.new("ScreenGui")
gui.Name = "DexterSuperFix"
gui.DisplayOrder = 999999
gui.ResetOnSpawn = false
pcall(function() gui.Parent = game:GetService("CoreGui") end)
if not gui.Parent then gui.Parent = LocalPlayer:WaitForChild("PlayerGui") end

-- NÚT ESP (LƠ LỬNG)
local btn1 = Instance.new("TextButton")
btn1.Name = "BTN_ESP"
btn1.Parent = gui
btn1.Size = UDim2.new(0, 150, 0, 50)
btn1.Position = UDim2.new(0.5, -160, 0.1, 0) -- Nằm góc trên màn hình
btn1.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
btn1.Text = "ESP: OFF"
btn1.TextColor3 = Color3.new(1, 1, 1)
btn1.Font = Enum.Font.GothamBold
btn1.TextSize = 18
btn1.ZIndex = 999999
btn1.Draggable = true
Instance.new("UICorner", btn1).CornerRadius = UDim.new(0, 8)

-- NÚT RECOIL (LƠ LỬNG)
local btn2 = Instance.new("TextButton")
btn2.Name = "BTN_RECOIL"
btn2.Parent = gui
btn2.Size = UDim2.new(0, 150, 0, 50)
btn2.Position = UDim2.new(0.5, 10, 0.1, 0) -- Nằm cạnh nút ESP
btn2.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
btn2.Text = "RECOIL: OFF"
btn2.TextColor3 = Color3.new(1, 1, 1)
btn2.Font = Enum.Font.GothamBold
btn2.TextSize = 18
btn2.ZIndex = 999999
btn2.Draggable = true
Instance.new("UICorner", btn2).CornerRadius = UDim.new(0, 8)

-- Sự kiện bấm nút
btn1.MouseButton1Click:Connect(function()
    Settings.ESP = not Settings.ESP
    btn1.Text = "ESP: " .. (Settings.ESP and "ON" or "OFF")
    btn1.BackgroundColor3 = Settings.ESP and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(200, 0, 0)
    if not Settings.ESP then
        for m, _ in pairs(Tracked) do ClearESP(m) end
    end
end)

btn2.MouseButton1Click:Connect(function()
    Settings.Recoil = not Settings.Recoil
    btn2.Text = "RECOIL: " .. (Settings.Recoil and "ON" or "OFF")
    btn2.BackgroundColor3 = Settings.Recoil and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(50, 50, 50)
end)

print("UI Brute Force Loaded! Look at the top of your screen.")

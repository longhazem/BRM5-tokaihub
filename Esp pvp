-- BRM5 v6.5 by DEXTER
-- NUCLEAR UI FIX: ÉP HIỂN THỊ NÚT BẰNG PIXEL TUYỆT ĐỐI
-- LOGIC: CHẾT MẤT ESP, HỒI SINH TỰ HIỆN

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

local Settings = {
    ESP = false,
    Recoil = false
}

local Tracked = {}

-- --- LOGIC ESP ---
local function ClearESP(m)
    if Tracked[m] then
        pcall(function()
            if Tracked[m].B then Tracked[m].B:Destroy() end
            if Tracked[m].C then Tracked[m].C:Disconnect() end
        end)
        Tracked[m] = nil
    end
end

local function MakeESP(m)
    if not m or Tracked[m] or not Settings.ESP then return end
    if not (m.Name == "Male" or m.Name == "Enemy" or (Players:GetPlayerFromCharacter(m) and m ~= LocalPlayer.Character)) then return end

    local hum = m:FindFirstChildOfClass("Humanoid")
    local hrp = m:FindFirstChild("Head") or m:FindFirstChild("HumanoidRootPart")

    if hum and hrp and hum.Health > 0 then
        local b = Instance.new("BoxHandleAdornment")
        b.Size = hrp.Size + Vector3.new(0.5, 0.5, 0.5)
        b.Adornee = hrp
        b.AlwaysOnTop = true
        b.ZIndex = 999
        b.Color3 = Color3.new(1, 0, 0)
        b.Transparency = 0.5
        b.Parent = hrp

        local c = hum.Died:Connect(function() ClearESP(m) end)
        Tracked[m] = {B = b, C = c}
    end
end

task.spawn(function()
    while true do
        task.wait(1)
        if Settings.ESP then
            for _, v in ipairs(Workspace:GetChildren()) do if v:IsA("Model") then MakeESP(v) end end
            for _, p in ipairs(Players:GetPlayers()) do if p.Character then MakeESP(p.Character) end end
        end
    end
end)

-- --- UI SIÊU CỨNG (ÉP HIỂN THỊ) ---
local gui = Instance.new("ScreenGui")
gui.Name = "DexterNuclear"
gui.ResetOnSpawn = false
gui.DisplayOrder = 999
pcall(function() gui.Parent = game:GetService("CoreGui") end)
if not gui.Parent then gui.Parent = LocalPlayer:WaitForChild("PlayerGui") end

local f = Instance.new("Frame")
f.Size = UDim2.new(0, 250, 0, 150)
f.Position = UDim2.new(0.5, -125, 0.5, -75)
f.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
f.BorderSizePixel = 2
f.BorderColor3 = Color3.fromRGB(0, 170, 255)
f.Active = true
f.Draggable = true
f.Parent = gui

local t = Instance.new("TextLabel")
t.Size = UDim2.new(1, 0, 0, 30)
t.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
t.Text = "DEXTER BRM5 - FIXED"
t.TextColor3 = Color3.new(1, 1, 1)
t.Font = Enum.Font.Code
t.TextSize = 15
t.Parent = f

-- NÚT 1: ESP
local b1 = Instance.new("TextButton")
b1.Size = UDim2.new(0, 230, 0, 40)
b1.Position = UDim2.new(0, 10, 0, 45)
b1.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
b1.Text = "ESP: OFF"
b1.TextColor3 = Color3.new(1, 1, 1)
b1.Font = Enum.Font.GothamBold
b1.TextSize = 14
b1.ZIndex = 1000
b1.Parent = f

b1.MouseButton1Click:Connect(function()
    Settings.ESP = not Settings.ESP
    b1.Text = "ESP: " .. (Settings.ESP and "ON" or "OFF")
    b1.BackgroundColor3 = Settings.ESP and Color3.new(0, 0.6, 0) or Color3.fromRGB(40, 40, 40)
    if not Settings.ESP then for m, _ in pairs(Tracked) do ClearESP(m) end end
end)

-- NÚT 2: NO RECOIL
local b2 = Instance.new("TextButton")
b2.Size = UDim2.new(0, 230, 0, 40)
b2.Position = UDim2.new(0, 10, 0, 95)
b2.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
b2.Text = "NO RECOIL: OFF"
b2.TextColor3 = Color3.new(1, 1, 1)
b2.Font = Enum.Font.GothamBold
b2.TextSize = 14
b2.ZIndex = 1000
b2.Parent = f

b2.MouseButton1Click:Connect(function()
    Settings.Recoil = not Settings.Recoil
    b2.Text = "NO RECOIL: " .. (Settings.Recoil and "ON" or "OFF")
    b2.BackgroundColor3 = Settings.Recoil and Color3.new(0, 0.6, 0) or Color3.fromRGB(40, 40, 40)
end)

-- Nút mở menu
local m = Instance.new("TextButton")
m.Size = UDim2.new(0, 40, 0, 40)
m.Position = UDim2.new(0, 10, 0, 10)
m.Text = "D"
m.BackgroundColor3 = Color3.new(0, 0.5, 1)
m.TextColor3 = Color3.new(1, 1, 1)
m.Draggable = true
m.Parent = gui
Instance.new("UICorner", m).CornerRadius = UDim.new(1, 0)

m.MouseButton1Click:Connect(function() f.Visible = not f.Visible end)

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local ESP_Active = false
local Hitbox_Active = false
local Hitbox_Size = 5
local Hitbox_Transparency = 0.5
local TrackedModels = {}
local DescendantConnection = nil

local NPC_Config = {
    ["Male"] = { Color = Color3.fromRGB(0, 255, 0) },
    ["Zombie"] = { Color = Color3.fromRGB(255, 0, 0) },
    ["Zombies"] = { Color = Color3.fromRGB(255, 0, 0) }
}

local function IsPlayer(model)
    return Players:GetPlayerFromCharacter(model) ~= nil
end

local function ApplyNPCFeatures(model)
    if IsPlayer(model) then return end
    local config = NPC_Config[model.Name]
    if not config then return end
    
    local head = model:WaitForChild("Head", 2)
    if not head or not head:IsA("BasePart") then return end

    -- X·ª≠ l√Ω ESP
    if ESP_Active and not head:FindFirstChild("Universal_ESP_Box") then
        local box = Instance.new("BoxHandleAdornment")
        box.Name = "Universal_ESP_Box"
        box.Size = head.Size + Vector3.new(0.5, 0.5, 0.5)
        box.Adornee = head
        box.AlwaysOnTop = true
        box.ZIndex = 5
        box.Color3 = config.Color
        box.Transparency = 0.4
        box.Parent = head
        TrackedModels[model] = box
    end

    -- X·ª≠ l√Ω Hitbox
    if Hitbox_Active then
        head.Size = Vector3.new(Hitbox_Size, Hitbox_Size, Hitbox_Size)
        head.Transparency = Hitbox_Transparency
        head.BrickColor = BrickColor.new("Bright blue")
        head.CanCollide = false
    else
        head.Size = Vector3.new(1.2, 1.2, 1.2) -- K√≠ch th∆∞·ªõc m·∫∑c ƒë·ªãnh BRM5
        head.Transparency = 0
    end
end

local function UpdateAllNPCs()
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and NPC_Config[obj.Name] then
            ApplyNPCFeatures(obj)
        end
    end
end

local function ClearESP()
    for model, box in pairs(TrackedModels) do
        if box then pcall(function() box:Destroy() end) end
    end
    TrackedModels = {}
end

local Window = Rayfield:CreateWindow({
    Name = "TOKAI-HUB-RBM5üêß",
    LoadingTitle = "TOKAI HUB",
    LoadingSubtitle = "by LONGTOKAI",
    Theme = "Bloom",
    ConfigurationSaving = { Enabled = false },
    KeySystem = false
})

local MainTab = Window:CreateTab("Main")

MainTab:CreateToggle({
    Name = "NPC ESP",
    CurrentValue = false,
    Flag = "NPC_ESP", 
    Callback = function(Value)
        ESP_Active = Value
        if not Value then ClearESP() end
        UpdateAllNPCs()
    end,
})

local CombatTab = Window:CreateTab("Combat")

CombatTab:CreateToggle({
    Name = "NPC Head Hitbox",
    CurrentValue = false,
    Flag = "Hitbox_Toggle",
    Callback = function(Value)
        Hitbox_Active = Value
        UpdateAllNPCs()
    end,
})

CombatTab:CreateSlider({
    Name = "Hitbox Size",
    Min = 1,
    Max = 20,
    Default = 5,
    Color = Color3.fromRGB(0, 150, 255),
    Increment = 1,
    ValueName = "Size",
    Callback = function(Value)
        Hitbox_Size = Value
        if Hitbox_Active then UpdateAllNPCs() end
    end,
})

local MiscTab = Window:CreateTab("Misc")

MiscTab:CreateButton({
    Name = "Unload",
    Callback = function()
        ESP_Active = false
        Hitbox_Active = false
        UpdateAllNPCs()
        ClearESP()
        Rayfield:Destroy()
    end,
})

-- V√≤ng l·∫∑p qu√©t NPC m·ªõi
task.spawn(function()
    while task.wait(2) do
        if ESP_Active or Hitbox_Active then
            UpdateAllNPCs()
        end
    end
end)

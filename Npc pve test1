local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- // TR·∫†NG TH√ÅI H·ªÜ TH·ªêNG //
local Config = {
    ESP_Enabled = false,
    Magic_Enabled = false,
    Wall_Check = true,
    Jitter_Mode = true,
    Hitbox_Size = 10,
    Target_NPCs = {["Male"] = true, ["Zombie"] = true, ["Zombies"] = true}
}

-- // H√ÄM KI·ªÇM TRA B·∫¢O M·∫¨T //
local function IsVisible(part)
    if not Config.Wall_Check then return true end
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {LocalPlayer.Character, part.Parent}
    params.FilterType = Enum.RaycastFilterType.Blacklist
    local result = Workspace:Raycast(Camera.CFrame.Position, (part.Position - Camera.CFrame.Position).Unit * 1000, params)
    return result == nil
end

-- // H√ÄM X·ª¨ L√ù NPC T·ªîNG H·ª¢P //
local function ProcessNPC(model)
    local head = model:FindFirstChild("Head")
    if not head then return end

    -- 1. ESP C·ªê ƒê·ªäNH SIZE (S·ª≠a l·ªói to theo hitbox)
    local esp = head:FindFirstChild("Fixed_ESP")
    if Config.ESP_Enabled then
        if not esp then
            esp = Instance.new("BoxHandleAdornment")
            esp.Name = "Fixed_ESP"
            esp.AlwaysOnTop = true
            esp.ZIndex = 10
            esp.Transparency = 0.5
            esp.Color3 = Color3.fromRGB(0, 255, 255)
            esp.Parent = head
        end
        esp.Adornee = head
        esp.Size = Vector3.new(1.2, 1.2, 1.2) -- Kh√≥a k√≠ch th∆∞·ªõc chu·∫©n
    else
        if esp then esp:Destroy() end
    end

    -- 2. MAGIC HITBOX & REDIRECT (Gom v√†o Combat)
    local magic = head:FindFirstChild("Combat_Magic")
    local shouldActivate = Config.Magic_Enabled and IsVisible(head)

    if shouldActivate then
        if not magic then
            magic = Instance.new("Part")
            magic.Name = "Combat_Magic"
            magic.Transparency = 1
            magic.CanCollide = false
            magic.Massless = true
            magic.CastShadow = false
            
            local weld = Instance.new("WeldConstraint")
            weld.Part0 = head
            weld.Part1 = magic
            weld.Parent = magic
            magic.Parent = head
        end
        
        -- C∆° ch·∫ø Jitter (B·∫£o m·∫≠t cao)
        local jitter = Config.Jitter_Mode and (math.random(-15, 15) / 100) or 0
        local finalSize = Config.Hitbox_Size + jitter
        magic.Size = Vector3.new(finalSize, finalSize, finalSize)
    else
        if magic then magic:Destroy() end
    end
end

-- // V√íNG L·∫∂P RENDER //
local MainLoop = RunService.RenderStepped:Connect(function()
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and Config.Target_NPCs[obj.Name] then
            ProcessNPC(obj)
        end
    end
end)

-- // GIAO DI·ªÜN RAYFIELD V5 //
local Window = Rayfield:CreateWindow({
    Name = "TOKAI-HUB (ALL-IN-COMBAT)üõ°Ô∏è",
    LoadingTitle = "Initializing Elite Script...",
    LoadingSubtitle = "Male | Zombie | Zombies Specialist",
    Theme = "Bloom",
    ConfigurationSaving = { Enabled = false }
})

local CombatTab = Window:CreateTab("Combat ‚öîÔ∏è")
local VisualTab = Window:CreateTab("Visuals üëÅÔ∏è")

-- T·∫§T C·∫¢ T√çNH NƒÇNG HITBOX N·∫∞M ·ªû ƒê√ÇY
CombatTab:CreateSection("Magic Hitbox System")

CombatTab:CreateToggle({
    Name = "Enable Magic Hitbox",
    CurrentValue = false,
    Callback = function(Value)
        Config.Magic_Enabled = Value
    end,
})

CombatTab:CreateSlider({
    Name = "Hitbox Radius",
    Min = 1,
    Max = 30,
    Default = 10,
    Increment = 1,
    ValueName = "Studs",
    Callback = function(Value)
        Config.Hitbox_Size = Value
    end,
})

CombatTab:CreateSection("Safety & Anti-Ban")

CombatTab:CreateToggle({
    Name = "Anti-Wall (B·∫Øt bu·ªôc b·∫≠t)",
    CurrentValue = true,
    Callback = function(Value)
        Config.Wall_Check = Value
    end,
})

CombatTab:CreateToggle({
    Name = "Security Jitter (Randomize)",
    CurrentValue = true,
    Callback = function(Value)
        Config.Jitter_Mode = Value
    end,
})

-- TAB VISUALS CHO ESP
VisualTab:CreateSection("ESP Display")

VisualTab:CreateToggle({
    Name = "Enable NPC ESP",
    CurrentValue = false,
    Callback = function(Value)
        Config.ESP_Enabled = Value
    end,
})

VisualTab:CreateSection("Settings")

VisualTab:CreateButton({
    Name = "Unload Script",
    Callback = function()
        MainLoop:Disconnect()
        Rayfield:Destroy()
    end,
})

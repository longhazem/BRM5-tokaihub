local Settings = {
    HitboxSize = 15,
    Enabled = true,
    Esp = true,
    SilentAim = true,
    Fov = 150
}

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- /// HÀM TẠO ESP VÀ HITBOX ///
local function ApplyHack(model)
    -- Tìm các bộ phận cần thiết
    local head = model:FindFirstChild("Head") or model:FindFirstChildOfClass("MeshPart")
    local root = model:FindFirstChild("HumanoidRootPart")
    local hum = model:FindFirstChildOfClass("Humanoid")

    if head and hum and hum.Health > 0 then
        -- 1. TẠO HITBOX HÌNH CẦU (FAKE PART)
        local hb = head:FindFirstChild("FakeHead")
        if Settings.Enabled then
            if not hb then
                hb = Instance.new("Part")
                hb.Name = "FakeHead"
                hb.Parent = head
                hb.Shape = Enum.PartType.Ball
                hb.CastShadow = false
                hb.CanCollide = false
                hb.Material = Enum.Material.ForceField -- Hiệu ứng đẹp, khó bị soi
                
                local weld = Instance.new("Weld", hb)
                weld.Part0 = hb
                weld.Part1 = head
            end
            hb.Size = Vector3.new(Settings.HitboxSize, Settings.HitboxSize, Settings.HitboxSize)
            hb.Transparency = 0.7
            hb.Color = Color3.new(1, 0, 0)
        elseif hb then
            hb:Destroy()
        end

        -- 2. TẠO ESP (CHỈ GẮN VÀO THÂN)
        if root then
            local box = root:FindFirstChild("ZomEsp")
            if Settings.Esp then
                if not box then
                    box = Instance.new("SelectionBox", root)
                    box.Name = "ZomEsp"
                    box.Adornee = root
                    box.LineThickness = 0.05
                    box.Color3 = Color3.new(0, 1, 0)
                end
                box.Visible = true
            elseif box then
                box.Visible = false
            end
        end
    end
end

-- /// VÒNG LẶP QUÉT TOÀN BỘ WORKSPACE ///
task.spawn(function()
    while task.wait(1) do
        -- Quét trong Workspace và các Folder con (phòng trường hợp NPC nằm trong Folder)
        for _, v in ipairs(workspace:GetDescendants()) do
            if v:IsA("Model") and v:FindFirstChildOfClass("Humanoid") and v ~= LocalPlayer.Character then
                ApplyHack(v)
            end
        end
    end
end)

-- /// SILENT AIM (ĐỂ BẮN TRÚNG HITBOX TO) ///
local mt = getrawmetatable(game)
local old = mt.__index
setreadonly(mt, false)

mt.__index = newcclosure(function(self, idx)
    if self == Mouse and (idx == "Hit" or idx == "Target") and Settings.SilentAim then
        local target = nil
        local dist = Settings.Fov
        
        for _, v in ipairs(workspace:GetDescendants()) do
            if v:IsA("Model") and v:FindFirstChild("Head") and v ~= LocalPlayer.Character then
                local head = v.Head
                local pos, vis = Camera:WorldToViewportPoint(head.Position)
                if vis then
                    local m = (Vector2.new(Mouse.X, Mouse.Y) - Vector2.new(pos.X, pos.Y)).Magnitude
                    if m < dist then
                        target = head
                        dist = m
                    end
                end
            end
        end
        if target then return (idx == "Hit" and target.CFrame or target) end
    end
    return old(self, idx)
end)
setreadonly(mt, true)

print("Script Loaded - Hitbox & ESP Fix Active")

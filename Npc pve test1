-- /// ZOM-HUB V9 (ENGINE-LEVEL HITBOX - ANTI-DETECTION) ///
local Settings = {
    HitboxSize = 15, -- Kích thước ảo (không đổi size thật)
    Chance = 100, -- Tỉ lệ trúng (để 100 là luôn trúng)
    WallCheck = true,
    NoRecoil = true
}

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera

-- HÀM TÌM NPC GẦN TÂM CHUỘT NHẤT (QUÉT QUA VECTOR)
local function GetClosestNPC()
    local target = nil
    local minDist = Settings.HitboxSize * 10 -- Quy đổi đơn vị sang pixel màn hình

    for _, v in ipairs(workspace:GetDescendants()) do
        if v:IsA("Model") and (v.Name == "Male" or v.Name == "Zombie" or v.Name == "Zombies") then
            local head = v:FindFirstChild("Head")
            if head and v:FindFirstChildOfClass("Humanoid") and v:FindFirstChildOfClass("Humanoid").Health > 0 then
                local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
                if onScreen then
                    local mousePos = Vector2.new(Mouse.X, Mouse.Y)
                    local dist = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
                    if dist < minDist then
                        target = head
                        minDist = dist
                    end
                end
            end
        end
    end
    return target
end

-- /// KỸ THUẬT HOOK RAYCAST (BẺ TIA TỪ GỐC) ///
-- Đây là cách các bản hack trả phí vượt Anticheat mà không bị ban
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    -- Nếu game gọi hàm Raycast hoặc FindPartOnRay để kiểm tra đạn trúng
    if (method == "Raycast" or method == "FindPartOnRayWithIgnoreList") and not checkcaller() then
        local targetHead = GetClosestNPC()
        
        if targetHead then
            -- Nếu có NPC trong tầm Hitbox ảo, ta "đánh lừa" kết quả trả về
            -- Thay vì trả về không gian trống, ta ép game nhận diện là trúng Head
            if Settings.WallCheck then
                -- Kiểm tra tường trước khi bẻ tia
                local rayParams = RaycastParams.new()
                rayParams.FilterType = Enum.RaycastFilterType.Exclude
                rayParams.FilterDescendantsInstances = {LocalPlayer.Character}
                local check = workspace:Raycast(Camera.CFrame.Position, (targetHead.Position - Camera.CFrame.Position).Unit * 1000, rayParams)
                
                if check and check.Instance:IsDescendantOf(targetHead.Parent) then
                    -- Bẻ hướng tia đạn thẳng vào đầu NPC
                    if args[1] and typeof(args[1]) == "Vector3" and args[2] and typeof(args[2]) == "Vector3" then
                        args[2] = (targetHead.Position - args[1]).Unit * 1000
                    end
                end
            end
        end
    end
    return oldNamecall(self, unpack(args))
end)

-- /// NO RECOIL (DẠNG KÍN) ///
game:GetService("RunService").RenderStepped:Connect(function()
    if Settings.NoRecoil then
        -- Chỉ xóa Spring để súng không nảy lên màn hình
        if Camera:FindFirstChild("Spring") then
            Camera.Spring.Value = Vector3.new(0,0,0)
        end
    end
end)

print("ZOM-HUB V9: Anti-Cheat Bypass Loaded")

-- /// CONFIG & SERVICES ///
local Settings = { Hitbox = 15, WallCheck = true, Enabled = true }
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera

-- /// Táº O UI (SELF-MADE) ///
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
ScreenGui.Name = "ZomHub_Mini"
ScreenGui.ResetOnSpawn = false

-- Menu ChÃ­nh
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 180, 0, 200)
MainFrame.Position = UDim2.new(0.5, -90, 0.4, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true -- CÃ³ thá»ƒ kÃ©o

local UICorner = Instance.new("UICorner", MainFrame)
UICorner.CornerRadius = UDim.new(0, 8)

-- Title
local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "ZOM-HUB v1"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBold

-- NÃºt Thu Nhá» (X)
local CloseBtn = Instance.new("TextButton", MainFrame)
CloseBtn.Size = UDim2.new(0, 25, 0, 25)
CloseBtn.Position = UDim2.new(1, -30, 0, 5)
CloseBtn.Text = "-"
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", CloseBtn)

-- NÃºt Má»Ÿ Nhanh (NÃºt ná»•i khi thu nhá»)
local OpenBtn = Instance.new("TextButton", ScreenGui)
OpenBtn.Size = UDim2.new(0, 40, 0, 40)
OpenBtn.Position = UDim2.new(0, 10, 0.5, 0)
OpenBtn.Text = "ðŸŽ¯"
OpenBtn.Visible = false
OpenBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
OpenBtn.Draggable = true
Instance.new("UICorner", OpenBtn).CornerRadius = UDim.new(1, 0)

-- HÃ m táº¡o NÃºt Báº­t/Táº¯t trong Menu
local function CreateToggle(name, pos, default, callback)
    local btn = Instance.new("TextButton", MainFrame)
    btn.Size = UDim2.new(0.8, 0, 0, 35)
    btn.Position = UDim2.new(0.1, 0, 0, pos)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    
    local function update()
        btn.Text = name .. ": " .. (default and "ON" or "OFF")
        btn.BackgroundColor3 = default and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(60, 60, 60)
        btn.TextColor3 = Color3.new(1,1,1)
    end
    
    btn.MouseButton1Click:Connect(function()
        default = not default
        update()
        callback(default)
    end)
    update()
    Instance.new("UICorner", btn)
end

-- /// Sá»° KIá»†N NÃšT ///
CreateToggle("Silent Aim", 45, Settings.Enabled, function(v) Settings.Enabled = v end)
CreateToggle("Wall Check", 90, Settings.WallCheck, function(v) Settings.WallCheck = v end)
CreateToggle("Hitbox 15/20", 135, true, function(v) Settings.Hitbox = v and 15 or 5 end)

CloseBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    OpenBtn.Visible = true
end)

OpenBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    OpenBtn.Visible = false
end)

-- /// LOGIC Báº®N (Báº¢N ANTI-BAN) ///
local function IsVisible(part)
    if not Settings.WallCheck then return true end
    local rayParam = RaycastParams.new()
    rayParam.FilterType = Enum.RaycastFilterType.Exclude
    rayParam.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    local result = workspace:Raycast(Camera.CFrame.Position, (part.Position - Camera.CFrame.Position).Unit * 500, rayParam)
    return result and result.Instance:IsDescendantOf(part.Parent)
end

local function GetTarget()
    if not Settings.Enabled then return nil end
    local Best, Closest = nil, Settings.Hitbox * 18
    for _, v in pairs(workspace:GetChildren()) do
        if (v.Name:find("Zombie") or v.Name:find("Male")) and v:FindFirstChild("Head") and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
            local Head = v.Head
            local Pos, OnScreen = Camera:WorldToViewportPoint(Head.Position)
            if OnScreen then
                local Dist = (Vector2.new(Mouse.X, Mouse.Y) - Vector2.new(Pos.X, Pos.Y)).Magnitude
                if Dist < Closest and IsVisible(Head) then
                    Closest = Dist
                    Best = Head
                end
            end
        end
    end
    return Best
end

-- Hook há»‡ thá»‘ng
local mt = getrawmetatable(game)
local old = mt.__index
setreadonly(mt, false)
mt.__index = newcclosure(function(self, idx)
    if self == Mouse and (idx == "Hit" or idx == "Target") and Settings.Enabled then
        local T = GetTarget()
        if T then return (idx == "Hit" and T.CFrame or T) end
    end
    return old(self, idx)
end)
setreadonly(mt, true)

print("UI Loaded: Sá»­ dá»¥ng nÃºt trÃ²n bÃªn trÃ¡i Ä‘á»ƒ má»Ÿ Menu!")

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- // DATA H·ªÜ TH·ªêNG //
local Config = {
    ESP = false,
    Magic = false,
    HitboxSize = 15,
    WallCheck = true,
    TargetNPCs = {["Male"] = true, ["Zombie"] = true, ["Zombies"] = true}
}

-- // H√ÄM KI·ªÇM TRA T·∫¶M NH√åN //
local function IsVisible(part)
    if not Config.WallCheck then return true end
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {LocalPlayer.Character, part.Parent}
    params.FilterType = Enum.RaycastFilterType.Blacklist
    local result = Workspace:Raycast(Camera.CFrame.Position, (part.Position - Camera.CFrame.Position).Unit * 1000, params)
    return result == nil
end

-- // CORE LOGIC //
local function UpdateNPC(model)
    local head = model:FindFirstChild("Head")
    if not head then return end

    -- ESP KH√îNG B·ªä TO (C·ªë ƒë·ªãnh size)
    local esp = head:FindFirstChild("FixedESP")
    if Config.ESP then
        if not esp then
            esp = Instance.new("BoxHandleAdornment")
            esp.Name = "FixedESP"
            esp.AlwaysOnTop = true
            esp.ZIndex = 10
            esp.Transparency = 0.5
            esp.Color3 = Color3.fromRGB(0, 255, 255)
            esp.Parent = head
        end
        esp.Adornee = head
        esp.Size = Vector3.new(1.2, 1.2, 1.2) -- Lu√¥n gi·ªØ size n√†y
    else
        if esp then esp:Destroy() end
    end

    -- MAGIC HITBOX (Redirect)
    local magic = head:FindFirstChild("MagicPart")
    if Config.Magic and IsVisible(head) then
        if not magic then
            magic = Instance.new("Part")
            magic.Name = "MagicPart"
            magic.Transparency = 1
            magic.CanCollide = false
            magic.Massless = true
            
            local weld = Instance.new("WeldConstraint")
            weld.Part0 = head
            weld.Part1 = magic
            weld.Parent = magic
            magic.Parent = head
        end
        magic.Size = Vector3.new(Config.HitboxSize, Config.HitboxSize, Config.HitboxSize)
    else
        if magic then magic:Destroy() end
    end
end

-- // LOOP //
local Loop = RunService.RenderStepped:Connect(function()
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and Config.TargetNPCs[obj.Name] then
            UpdateNPC(obj)
        end
    end
end)

-- // GIAO DI·ªÜN M·ªöI (FIX CHO MOBILE) //
local Window = Rayfield:CreateWindow({
    Name = "TOKAI-HUB V4 üõ°Ô∏è",
    LoadingTitle = "Mobile Fix Loaded",
    LoadingSubtitle = "Male | Zombie Specialist",
    Theme = "Bloom",
    ConfigurationSaving = { Enabled = false }
})

-- Gom t·∫•t c·∫£ v√†o 2 Tab ch√≠nh ƒë·ªÉ d·ªÖ nh√¨n tr√™n ƒëi·ªán tho·∫°i
local MainTab = Window:CreateTab("Combat ‚öîÔ∏è")
local VisualTab = Window:CreateTab("Visuals üëÅÔ∏è")

-- PH·∫¶N CHI·∫æN ƒê·∫§U
MainTab:CreateSection("Main Cheats")

MainTab:CreateToggle({
    Name = "Magic Hitbox",
    CurrentValue = false,
    Callback = function(Value)
        Config.Magic = Value
    end,
})

MainTab:CreateSlider({
    Name = "Hitbox Radius (1-30)",
    Min = 1,
    Max = 30,
    Default = 15,
    Increment = 1,
    Callback = function(Value)
        Config.HitboxSize = Value
    end,
})

MainTab:CreateSection("Safety Features")

MainTab:CreateToggle({
    Name = "Anti-Wall Ban",
    CurrentValue = true,
    Callback = function(Value)
        Config.WallCheck = Value
    end,
})

-- PH·∫¶N HI·ªÇN TH·ªä
VisualTab:CreateSection("ESP Settings")

VisualTab:CreateToggle({
    Name = "NPC ESP (Fixed Size)",
    CurrentValue = false,
    Callback = function(Value)
        Config.ESP = Value
    end,
})

VisualTab:CreateButton({
    Name = "Force Unload Script",
    Callback = function()
        Loop:Disconnect()
        Rayfield:Destroy()
    end,
})

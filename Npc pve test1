local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- // TR·∫†NG TH√ÅI H·ªÜ TH·ªêNG //
local Config = {
    ESP = false,
    Hitbox = false,
    Size = 6,
    Transparency = 1,
    FOV_Check = true, -- Ch·ªâ b·∫≠t hitbox khi nh√¨n v·ªÅ ph√≠a m·ª•c ti√™u
    Wall_Check = true -- Kh√¥ng b·∫≠t hitbox n·∫øu ƒë·ªãch sau t∆∞·ªùng
}

local NPC_Names = { ["Male"] = true, ["Zombie"] = true, ["Zombies"] = true }

-- // H√ÄM KI·ªÇM TRA AN TO√ÄN //
local function IsVisible(targetPart)
    if not Config.Wall_Check then return true end
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {LocalPlayer.Character, targetPart.Parent}
    params.FilterType = Enum.RaycastFilterType.Blacklist
    
    local origin = Camera.CFrame.Position
    local direction = (targetPart.Position - origin).Unit * (targetPart.Position - origin).Magnitude
    local result = Workspace:Raycast(origin, direction, params)
    
    return result == nil -- N·∫øu kh√¥ng ch·∫°m g√¨ t·ª©c l√† nh√¨n th·∫•y
end

local function IsInFOV(targetPart)
    if not Config.FOV_Check then return true end
    local _, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
    return onScreen
end

-- // QU·∫¢N L√ù NPC //
local function ApplyEliteFeatures(model)
    if Players:GetPlayerFromCharacter(model) then return end
    local head = model:FindFirstChild("Head")
    if not head or not head:IsA("BasePart") then return end

    -- ESP AN TO√ÄN (C·ªë ƒë·ªãnh k√≠ch th∆∞·ªõc chu·∫©n)
    local esp = head:FindFirstChild("Elite_ESP")
    if Config.ESP then
        if not esp then
            esp = Instance.new("BoxHandleAdornment")
            esp.Name = "Elite_ESP"
            esp.AlwaysOnTop = true
            esp.ZIndex = 5
            esp.Transparency = 0.6
            esp.Color3 = Color3.fromRGB(0, 255, 127)
            esp.Parent = head
        end
        esp.Adornee = head
        esp.Size = Vector3.new(1.3, 1.3, 1.3)
    else
        if esp then esp:Destroy() end
    end

    -- HITBOX B·∫¢O M·∫¨T (T·ª± ƒë·ªông th√≠ch ·ª©ng)
    local hitbox = head:FindFirstChild("Stealth_Part")
    local shouldActivate = Config.Hitbox and IsVisible(head) and IsInFOV(head)

    if shouldActivate then
        if not hitbox then
            hitbox = Instance.new("Part")
            hitbox.Name = "Stealth_Part"
            hitbox.CanCollide = false
            hitbox.Massless = true
            hitbox.CastShadow = false
            hitbox.Transparency = 1 -- Lu√¥n t√†ng h√¨nh
            
            local weld = Instance.new("WeldConstraint")
            weld.Part0 = head
            weld.Part1 = hitbox
            weld.Parent = hitbox
            hitbox.Parent = head
        end
        
        -- Jitter: K√≠ch th∆∞·ªõc thay ƒë·ªïi ng·∫´u nhi√™n nh·∫π ƒë·ªÉ qua m·∫∑t server
        local jitter = (math.random(-10, 10) / 100)
        local safeSize = Config.Size + jitter
        hitbox.Size = Vector3.new(safeSize, safeSize, safeSize)
    else
        if hitbox then hitbox:Destroy() end
    end
end

-- // V√íNG L·∫∂P CH√çNH (RenderStepped cho ƒë·ªô tr·ªÖ th·∫•p nh·∫•t) //
local MainLoop
MainLoop = RunService.RenderStepped:Connect(function()
    if not (Config.ESP or Config.Hitbox) then return end
    
    for _, obj in ipairs(Workspace:GetChildren()) do
        if obj:IsA("Model") and NPC_Names[obj.Name] then
            ApplyEliteFeatures(obj)
        end
    end
end)

-- // GIAO DI·ªÜN //
local Window = Rayfield:CreateWindow({
    Name = "TOKAI-HUB (ELITE SAFE)üõ°Ô∏è",
    LoadingTitle = "Secured Environment",
    LoadingSubtitle = "Anti-Ban Protection Active",
    Theme = "Bloom",
    ConfigurationSaving = { Enabled = false }
})

local CombatTab = Window:CreateTab("Combat")

CombatTab:CreateToggle({
    Name = "Elite Stealth Hitbox",
    CurrentValue = false,
    Callback = function(Value)
        Config.Hitbox = Value
    end,
})

CombatTab:CreateSlider({
    Name = "Safe Hitbox Radius",
    Min = 1,
    Max = 15,
    Default = 6,
    Color = Color3.fromRGB(0, 170, 255),
    Increment = 0.5,
    ValueName = "Studs",
    Callback = function(Value)
        Config.Size = Value
    end,
})

CombatTab:CreateToggle({
    Name = "Wall Check (B·∫£o m·∫≠t cao)",
    CurrentValue = true,
    Callback = function(Value)
        Config.Wall_Check = Value
    end,
})

local VisualTab = Window:CreateTab("Visuals")

VisualTab:CreateToggle({
    Name = "Fixed ESP",
    CurrentValue = false,
    Callback = function(Value)
        Config.ESP = Value
    end,
})

local MiscTab = Window:CreateTab("Misc")

MiscTab:CreateButton({
    Name = "Safe Unload",
    Callback = function()
        Config.Hitbox = false
        Config.ESP = false
        if MainLoop then MainLoop:Disconnect() end
        task.wait(0.2)
        -- D·ªçn d·∫πp tri·ªát ƒë·ªÉ
        for _, obj in ipairs(Workspace:GetChildren()) do
            if obj:IsA("Model") and NPC_Names[obj.Name] then
                local head = obj:FindFirstChild("Head")
                if head then
                    if head:FindFirstChild("Stealth_Part") then head.Stealth_Part:Destroy() end
                    if head:FindFirstChild("Elite_ESP") then head.Elite_ESP:Destroy() end
                end
            end
        end
        Rayfield:Destroy()
    end,
})

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local ESP_Active = false
local Hitbox_Active = false
local Hitbox_Size = 5
local Hitbox_Transparency = 0.5
local TrackedModels = {}

local NPC_Config = {
    ["Male"] = { Color = Color3.fromRGB(0, 255, 0) },
    ["Zombie"] = { Color = Color3.fromRGB(255, 0, 0) },
    ["Zombies"] = { Color = Color3.fromRGB(255, 0, 0) }
}

local function IsPlayer(model)
    return Players:GetPlayerFromCharacter(model) ~= nil
end

local function ProcessNPC(model)
    if not model or IsPlayer(model) then return end
    local config = NPC_Config[model.Name]
    if not config then return end
    
    local head = model:FindFirstChild("Head")
    if not head or not head:IsA("BasePart") then return end

    -- C·∫≠p nh·∫≠t ESP
    if ESP_Active then
        local box = head:FindFirstChild("Universal_ESP_Box")
        if not box then
            box = Instance.new("BoxHandleAdornment")
            box.Name = "Universal_ESP_Box"
            box.Adornee = head
            box.AlwaysOnTop = true
            box.ZIndex = 5
            box.Transparency = 0.4
            box.Parent = head
        end
        box.Size = head.Size + Vector3.new(0.5, 0.5, 0.5)
        box.Color3 = config.Color
        TrackedModels[model] = box
    else
        local box = head:FindFirstChild("Universal_ESP_Box")
        if box then box:Destroy() end
    end

    -- C·∫≠p nh·∫≠t Hitbox th·∫ßn t·ªëc
    if Hitbox_Active then
        head.Size = Vector3.new(Hitbox_Size, Hitbox_Size, Hitbox_Size)
        head.Transparency = Hitbox_Transparency
        head.CanCollide = false
    else
        -- Tr·∫£ v·ªÅ tr·∫°ng th√°i g·ªëc n·∫øu t·∫Øt
        if head.Size ~= Vector3.new(1.2, 1.2, 1.2) then
            head.Size = Vector3.new(1.2, 1.2, 1.2)
            head.Transparency = 0
        end
    end
end

-- V√≤ng l·∫∑p si√™u t·ªëc 0.01s
RunService.Stepped:Connect(function()
    if ESP_Active or Hitbox_Active then
        for _, obj in ipairs(Workspace:GetChildren()) do
            if obj:IsA("Model") and NPC_Config[obj.Name] then
                ProcessNPC(obj)
            end
        end
    end
end)

local Window = Rayfield:CreateWindow({
    Name = "TOKAI-HUB-RBM5üêß",
    LoadingTitle = "TOKAI HUB",
    LoadingSubtitle = "by LONGTOKAI",
    Theme = "Bloom",
    ConfigurationSaving = { Enabled = false },
    KeySystem = false
})

local MainTab = Window:CreateTab("Main")

MainTab:CreateToggle({
    Name = "NPC ESP",
    CurrentValue = false,
    Flag = "NPC_ESP", 
    Callback = function(Value)
        ESP_Active = Value
        if not Value then
            for model, box in pairs(TrackedModels) do
                if box then pcall(function() box:Destroy() end) end
            end
            TrackedModels = {}
        end
    end,
})

local CombatTab = Window:CreateTab("Combat")

CombatTab:CreateToggle({
    Name = "Head Hitbox",
    CurrentValue = false,
    Flag = "Hitbox",
    Callback = function(Value)
        Hitbox_Active = Value
    end,
})

CombatTab:CreateSlider({
    Name = "Size",
    Min = 1,
    Max = 20,
    Default = 5,
    Color = Color3.fromRGB(0, 150, 255),
    Increment = 1,
    ValueName = "Scale",
    Callback = function(Value)
        Hitbox_Size = Value
    end,
})

local MiscTab = Window:CreateTab("Misc")

MiscTab:CreateButton({
    Name = "Unload",
    Callback = function()
        ESP_Active = false
        Hitbox_Active = false
        task.wait(0.1)
        Rayfield:Destroy()
    end,
})

-- /// ZOM-HUB V7 (FAKE HITBOX - LEGIT METHOD) ///
local Settings = { 
    HitboxSize = 12, -- Độ rộng vừa phải để an toàn (12 là chuẩn nhất)
    Enabled = true,
    EspEnabled = true,
    NoRecoil = true
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- /// HÀM TẠO HITBOX ẢO (KHÔNG CHẠM VÀO HEAD THẬT) ///
local function CreateFakeHitbox(npc)
    local head = npc:FindFirstChild("Head")
    if head and not head:FindFirstChild("FakeHead") then
        local fake = Instance.new("Part")
        fake.Name = "FakeHead"
        fake.Size = Vector3.new(Settings.HitboxSize, Settings.HitboxSize, Settings.HitboxSize)
        fake.Transparency = 0.8 -- Màu đỏ mờ để cậu thấy
        fake.Color = Color3.new(1, 0, 0)
        fake.CanCollide = false
        fake.Anchored = false
        fake.AlwaysOnTop = false -- Để nó không bị lộ qua tường
        fake.Parent = head
        
        -- Hàn chặt vào đầu thật
        local weld = Instance.new("Weld")
        weld.Part0 = head
        weld.Part1 = fake
        weld.C0 = CFrame.new(0, 0, 0)
        weld.Parent = fake

        -- Thêm ESP Khung dây
        local selection = Instance.new("SelectionBox")
        selection.Adornee = fake
        selection.Color3 = Color3.new(1, 0, 0)
        selection.LineThickness = 0.02
        selection.Parent = fake
    end
end

-- /// QUÉT NPC LIÊN TỤC ///
RunService.Heartbeat:Connect(function()
    for _, v in ipairs(workspace:GetDescendants()) do
        if v:IsA("Model") and (v.Name == "Male" or v.Name == "Zombie" or v.Name == "Zombies") then
            if not Players:GetPlayerFromCharacter(v) then
                local hum = v:FindFirstChildOfClass("Humanoid")
                if hum and hum.Health > 0 then
                    CreateFakeHitbox(v)
                end
            end
        end
    end
    
    -- No Recoil kín đáo
    if Settings.NoRecoil then
        local cam = workspace.CurrentCamera
        if cam:FindFirstChild("Spring") then
            cam.Spring.Value = Vector3.new(0,0,0)
        end
    end
end)

-- /// CHỈNH SỬA HỆ THỐNG ĐẠN (SILENT AIM KÍN) ///
local mt = getrawmetatable(game)
local old = mt.__index
setreadonly(mt, false)

mt.__index = newcclosure(function(self, idx)
    if self == game:GetService("Players").LocalPlayer:GetMouse() and (idx == "Hit" or idx == "Target") and Settings.Enabled then
        -- Tìm cái FakeHead gần tâm chuột nhất
        local target = nil
        local minDist = 200 -- Giới hạn khoảng cách chuột để tránh bắn quá ảo
        
        for _, v in ipairs(workspace:GetDescendants()) do
            if v.Name == "FakeHead" then
                local screenPos, onScreen = Camera:WorldToViewportPoint(v.Position)
                if onScreen then
                    local mousePos = game:GetService("UserInputService"):GetMouseLocation()
                    local dist = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
                    if dist < minDist then
                        minDist = dist
                        target = v
                    end
                end
            end
        end
        
        if target then
            -- Bắn vào đầu thật bên trong cái FakeHead
            return (idx == "Hit" and target.Parent.CFrame or target.Parent)
        end
    end
    return old(self, idx)
end)

setreadonly(mt, true)

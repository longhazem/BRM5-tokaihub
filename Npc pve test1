local a = {
    b = 150, 
    c = true, 
    d = true, 
    e = true, 
    f = true, 
    g = 800,
    -- Định nghĩa màu sắc
    color_male = Color3.fromRGB(0, 255, 0),
    color_zombie = Color3.fromRGB(255, 0, 0)
}

local h = game:GetService("Players")
local i = game:GetService("RunService")
local j = h.LocalPlayer
local k = j:GetMouse()
local l = workspace.CurrentCamera

-- UI Tối ưu cho Mobile
local m = Instance.new("ScreenGui", j:FindFirstChildOfClass("PlayerGui"))
m.Name = "ZomColorFix"
m.ResetOnSpawn = false

local n = Instance.new("Frame", m)
n.Size = UDim2.new(0, 140, 0, 160)
n.Position = UDim2.new(0.05, 0, 0.25, 0)
n.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
n.BackgroundTransparency = 0.2
n.BorderSizePixel = 0
n.Active = true
n.Draggable = true
Instance.new("UICorner", n).CornerRadius = UDim.new(0, 10)

local function o(p, q, r)
    local s = Instance.new("TextButton", n)
    s.Size = UDim2.new(0.85, 0, 0, 28)
    s.Position = UDim2.new(0.07, 0, 0, q)
    s.BackgroundColor3 = a[r] and Color3.fromRGB(0, 160, 0) or Color3.fromRGB(70, 70, 70)
    s.Text = p .. ": " .. (a[r] and "ON" or "OFF")
    s.TextColor3 = Color3.new(1, 1, 1)
    s.Font = Enum.Font.SourceSansBold
    s.TextSize = 12
    Instance.new("UICorner", s)

    s.MouseButton1Click:Connect(function()
        a[r] = not a[r]
        s.Text = p .. ": " .. (a[r] and "ON" or "OFF")
        s.BackgroundColor3 = a[r] and Color3.fromRGB(0, 160, 0) or Color3.fromRGB(70, 70, 70)
    end)
end

o("Silent Aim", 35, "c")
o("No Recoil", 65, "d")
o("Wall Check", 95, "f")
o("ESP Color", 125, "e")

-- KIỂM TRA TƯỜNG
local function p(q)
    if not a.f then return true end
    local r = j.Character
    if not r or not r:FindFirstChild("Head") then return false end
    
    local s = RaycastParams.new()
    s.FilterType = Enum.RaycastFilterType.Exclude
    s.FilterDescendantsInstances = {r, l}
    
    local t = l.CFrame.Position
    local u = q.Position - t
    local v = workspace:Raycast(t, u, s)
    
    return (not v or v.Instance:IsDescendantOf(q.Parent))
end

-- QUÉT NPC VÀ PHÂN LOẠI MÀU
local w = {}
task.spawn(function()
    while task.wait(1) do 
        local x = {}
        local char = j.Character
        local root = char and char:FindFirstChild("HumanoidRootPart")
        
        for _, z in ipairs(workspace:GetChildren()) do
            -- Kiểm tra các Model tiềm năng
            if z:IsA("Model") and z:FindFirstChildOfClass("Humanoid") then
                if not h:GetPlayerFromCharacter(z) then
                    local head = z:FindFirstChild("Head")
                    local hum = z:FindFirstChildOfClass("Humanoid")
                    
                    if head and hum and hum.Health > 0 then
                        local dist = root and (head.Position - root.Position).Magnitude or 0
                        if dist < a.g then
                            table.insert(x, head)
                            
                            -- Xử lý ESP màu sắc
                            if a.e then
                                local hl = z:FindFirstChild("ZomH") or Instance.new("Highlight", z)
                                hl.Name = "ZomH"
                                
                                -- Phân loại màu theo tên
                                if z.Name == "Male" then
                                    hl.FillColor = a.color_male
                                elseif z.Name == "Zombie" or z.Name == "Zombies" then
                                    hl.FillColor = a.color_zombie
                                else
                                    hl.FillColor = Color3.new(1, 1, 1) -- Màu trắng cho các NPC khác
                                end
                                
                                hl.FillTransparency = 0.6
                                hl.OutlineColor = Color3.new(1, 1, 1)
                                hl.Enabled = true
                            elseif z:FindFirstChild("ZomH") then
                                z.ZomH.Enabled = false
                            end
                        end
                    end
                end
            end
        end
        w = x
    end
end)

-- SILENT AIM LOGIC
local function y()
    local z = nil
    local A = a.b
    for _, B in ipairs(w) do
        if B and B.Parent then
            local C, D = l:WorldToViewportPoint(B.Position)
            if D and p(B) then
                local E = (Vector2.new(k.X, k.Y) - Vector2.new(C.X, C.Y)).Magnitude
                if E < A then
                    z = B
                    A = E
                end
            end
        end
    end
    return z
end

local F = getrawmetatable(game)
local G = F.__index
local H = F.__namecall
setreadonly(F, false)

F.__index = newcclosure(function(self, I)
    if not checkcaller() and a.c and self == k and (I == "Hit" or I == "Target") then
        local J = y()
        if J then return (I == "Hit" and J.CFrame or J) end
    end
    return G(self, I)
end)

F.__namecall = newcclosure(function(self, ...)
    local K = getnamecallmethod()
    local L = {...}
    if not checkcaller() and a.c and K == "Raycast" and self == workspace then
        local J = y()
        if J then
            L[2] = (J.Position - L[1]).Unit * L[2].Magnitude
            return H(self, unpack(L))
        end
    end
    return H(self, ...)
end)
setreadonly(F, true)

-- NO RECOIL
i.RenderStepped:Connect(function()
    if a.d then
        local M = l:FindFirstChild("Recoil") or l:FindFirstChild("Spring")
        if M and M:IsA("Vector3Value") then M.Value = Vector3.zero end
    end
end)

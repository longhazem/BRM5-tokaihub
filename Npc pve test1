-- /// CẤU HÌNH CƠ BẢN ///
local Settings = {
    Enabled = false,       -- Bật/Tắt chức năng
    FOV = 150,             -- Phạm vi hoạt động (vòng tròn quanh chuột)
    TargetPart = "Head",   -- Phần cơ thể muốn nhắm vào
    TeamCheck = true       -- Kiểm tra đồng đội (True = không nhắm đồng đội)
}

-- /// DỊCH VỤ (SERVICES) ///
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- /// TẠO UI TỰ CHẾ (CUSTOM UI - NO LIBRARY) ///
-- Xóa UI cũ nếu có để tránh trùng lặp
if game.CoreGui:FindFirstChild("MyCustomAimUI") then
    game.CoreGui.MyCustomAimUI:Destroy()
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MyCustomAimUI"
ScreenGui.Parent = game.CoreGui -- Đưa vào CoreGui để không bị reset khi chết

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 200, 0, 120)
MainFrame.Position = UDim2.new(0.5, -100, 0.5, -60)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35) -- Màu xám tối
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true -- Cho phép kéo thả bảng
MainFrame.Parent = ScreenGui

-- Bo tròn góc
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

-- Tiêu đề
local Title = Instance.new("TextLabel")
Title.Text = "TEST MODE: SILENT"
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.Parent = MainFrame

-- Nút Bật/Tắt
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleBtn"
ToggleButton.Size = UDim2.new(0.8, 0, 0, 40)
ToggleButton.Position = UDim2.new(0.1, 0, 0.4, 0)
ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50) -- Màu đỏ (Tắt)
ToggleButton.Text = "TRẠNG THÁI: TẮT"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Font = Enum.Font.Gotham
ToggleButton.TextSize = 12
ToggleButton.Parent = MainFrame

local BtnCorner = Instance.new("UICorner")
BtnCorner.CornerRadius = UDim.new(0, 6)
BtnCorner.Parent = ToggleButton

-- Vòng tròn FOV (Chỉ để nhìn thấy vùng hoạt động)
local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = Settings.Enabled
FOVCircle.Radius = Settings.FOV
FOVCircle.Color = Color3.fromRGB(255, 255, 255)
FOVCircle.Thickness = 1
FOVCircle.Filled = false
FOVCircle.Transparency = 1

-- /// LOGIC UI ///
ToggleButton.MouseButton1Click:Connect(function()
    Settings.Enabled = not Settings.Enabled
    
    if Settings.Enabled then
        ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50) -- Xanh lá
        ToggleButton.Text = "TRẠNG THÁI: ĐANG CHẠY"
        FOVCircle.Visible = true
    else
        ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50) -- Đỏ
        ToggleButton.Text = "TRẠNG THÁI: TẮT"
        FOVCircle.Visible = false
    end
end)

-- /// HÀM TÌM MỤC TIÊU GẦN NHẤT (GET CLOSEST TARGET) ///
local function GetClosestPlayer()
    local ClosestTarget = nil
    local ShortestDistance = Settings.FOV

    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 and v.Character:FindFirstChild(Settings.TargetPart) then
            -- Check Đồng đội
            if Settings.TeamCheck and v.Team == LocalPlayer.Team then
                continue 
            end

            -- Chuyển vị trí 3D sang 2D màn hình
            local pos = Camera:WorldToViewportPoint(v.Character[Settings.TargetPart].Position)
            local magnitude = (Vector2.new(pos.X, pos.Y) - Vector2.new(Mouse.X, Mouse.Y)).Magnitude

            if magnitude < ShortestDistance then
                ClosestTarget = v
                ShortestDistance = magnitude
            end
        end
    end
    return ClosestTarget
end

-- /// VÒNG LẶP CHÍNH ///
RunService.RenderStepped:Connect(function()
    -- Cập nhật vị trí vòng tròn FOV theo chuột
    FOVCircle.Position = Vector2.new(UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y)
    
    if Settings.Enabled then
        local Target = GetClosestPlayer()
        if Target then
            -- HIỆN TẠI: Chỉ in tên mục tiêu ra console để test logic
            -- TƯƠNG LAI: Đây là nơi bạn đặt logic "Silent Aim"
            
            -- Ví dụ Logic (Dạng giả lập):
            -- _G.SilentAimTarget = Target.Character[Settings.TargetPart]
            
            Title.Text = "LOCKED: " .. Target.Name -- Hiển thị tên kẻ địch đang bị nhắm trên UI
            Title.TextColor3 = Color3.fromRGB(255, 50, 50)
        else
            Title.Text = "SCANNING..."
            Title.TextColor3 = Color3.fromRGB(255, 255, 255)
        end
    end
end)

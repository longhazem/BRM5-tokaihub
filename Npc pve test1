local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- // SETTINGS //
local Config = {
    ESP_Enabled = false,
    Magic_Enabled = false,
    Hitbox_Size = 10,
    Wall_Check = true,
    Target_NPCs = {["Male"] = true, ["Zombie"] = true, ["Zombies"] = true}
}

-- // CORE FUNCTIONS //
local function IsInSight(part)
    if not Config.Wall_Check then return true end
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {LocalPlayer.Character, part.Parent}
    params.FilterType = Enum.RaycastFilterType.Blacklist
    local result = Workspace:Raycast(Camera.CFrame.Position, (part.Position - Camera.CFrame.Position).Unit * 1000, params)
    return result == nil
end

local function UpdateNPC(model)
    local head = model:FindFirstChild("Head")
    if not head then return end

    -- 1. FIXED ESP (N√∫t On/Off ·ªü Tab Visuals)
    local esp = head:FindFirstChild("Mobile_ESP")
    if Config.ESP_Enabled then
        if not esp then
            esp = Instance.new("BoxHandleAdornment")
            esp.Name = "Mobile_ESP"
            esp.AlwaysOnTop = true
            esp.ZIndex = 10
            esp.Transparency = 0.5
            esp.Color3 = Color3.fromRGB(0, 255, 150)
            esp.Parent = head
        end
        esp.Adornee = head
        esp.Size = Vector3.new(1.2, 1.2, 1.2) -- Kh√≥a c·ª©ng size nh·ªè
    else
        if esp then esp:Destroy() end
    end

    -- 2. MAGIC HITBOX
    local magic = head:FindFirstChild("Mobile_Magic")
    if Config.Magic_Enabled and IsInSight(head) then
        if not magic then
            magic = Instance.new("Part")
            magic.Name = "Mobile_Magic"
            magic.Transparency = 1
            magic.CanCollide = false
            magic.Massless = true
            
            local weld = Instance.new("WeldConstraint")
            weld.Part0 = head
            weld.Part1 = magic
            weld.Parent = magic
            magic.Parent = head
        end
        magic.Size = Vector3.new(Config.Hitbox_Size, Config.Hitbox_Size, Config.Hitbox_Size)
    else
        if magic then magic:Destroy() end
    end
end

-- // RENDER LOOP //
local MainLoop = RunService.RenderStepped:Connect(function()
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and Config.Target_NPCs[obj.Name] then
            UpdateNPC(obj)
        end
    end
end)

-- // UI INTERFACE //
local Window = Rayfield:CreateWindow({
    Name = "TOKAI-HUB V5 (MOBILE)üêß",
    LoadingTitle = "Fixing ESP Controls...",
    LoadingSubtitle = "Male | Zombie | Zombies",
    Theme = "Bloom",
    ConfigurationSaving = { Enabled = false }
})

local CombatTab = Window:CreateTab("Combat ‚öîÔ∏è")
local VisualTab = Window:CreateTab("Visuals üëÅÔ∏è")

-- TAB COMBAT
CombatTab:CreateSection("Magic Settings")

CombatTab:CreateToggle({
    Name = "Magic Hitbox",
    CurrentValue = false,
    Callback = function(Value)
        Config.Magic_Enabled = Value
    end,
})

CombatTab:CreateSlider({
    Name = "Hitbox Radius",
    Min = 1,
    Max = 30, -- Kh√≥a t·ªëi ƒëa 30 ƒë·ªÉ an to√†n
    Default = 10,
    Increment = 1,
    ValueName = "Studs",
    Callback = function(Value)
        Config.Hitbox_Size = Value
    end,
})

CombatTab:CreateToggle({
    Name = "Anti-Wall Ban",
    CurrentValue = true,
    Callback = function(Value)
        Config.Wall_Check = Value
    end,
})

-- TAB VISUALS (S·ª¨A L·ªñI N√öT ESP)
VisualTab:CreateSection("ESP Controls")

VisualTab:CreateToggle({
    Name = "Enable NPC ESP", -- ƒê√¢y l√† n√∫t b·∫°n c·∫ßn
    CurrentValue = false,
    Callback = function(Value)
        Config.ESP_Enabled = Value
    end,
})

VisualTab:CreateSection("Extra")

VisualTab:CreateButton({
    Name = "Reset Everything",
    Callback = function()
        Config.ESP_Enabled = false
        Config.Magic_Enabled = false
    end,
})

VisualTab:CreateButton({
    Name = "Unload Script",
    Callback = function()
        MainLoop:Disconnect()
        Rayfield:Destroy()
    end,
})

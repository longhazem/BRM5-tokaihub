local Settings = {
    HitboxSize = 15,
    Enabled = true,
    Esp = true,
}

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- /// UI CŨ CỦA BẠN ///
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 150, 0, 110)
Main.Position = UDim2.new(0.1, 0, 0.4, 0)
Main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Main.Draggable = true

local function CreateBtn(text, pos, setting)
    local btn = Instance.new("TextButton", Main)
    btn.Size = UDim2.new(0.9, 0, 0, 40)
    btn.Position = UDim2.new(0.05, 0, 0, pos)
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.Text = text .. ": ON"
    btn.TextColor3 = Color3.new(1, 1, 1)
    
    btn.MouseButton1Click:Connect(function()
        Settings[setting] = not Settings[setting]
        btn.Text = text .. (Settings[setting] and ": ON" or ": OFF")
        btn.BackgroundColor3 = Settings[setting] and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(150, 0, 0)
    end)
end

CreateBtn("Hitbox 15", 10, "Enabled")
CreateBtn("ESP Body", 60, "Esp")

-- /// XỬ LÝ HITBOX & ESP ///
task.spawn(function()
    while task.wait(0.1) do
        for _, v in ipairs(workspace:GetDescendants()) do
            if v:IsA("Model") and v:FindFirstChild("Head") and v:FindFirstChildOfClass("Humanoid") and v ~= LocalPlayer.Character then
                local head = v.Head
                local root = v:FindFirstChild("HumanoidRootPart")
                
                -- Hitbox Hình Đầu (Ball) - Cố gắng lách Anti-cheat
                if Settings.Enabled then
                    head.Shape = Enum.PartType.Ball
                    head.Size = Vector3.new(Settings.HitboxSize, Settings.HitboxSize, Settings.HitboxSize)
                    head.Transparency = 0.8
                    head.CanCollide = false -- Quan trọng: Không để nhân vật bị kẹt vào hitbox
                else
                    head.Shape = Enum.PartType.Block
                    head.Size = Vector3.new(1.2, 1.2, 1.2)
                    head.Transparency = 0
                end

                -- ESP Fix: Gắn vào RootPart để không bị to theo đầu
                if root then
                    local box = root:FindFirstChild("SelectionBox")
                    if Settings.Esp then
                        if not box then
                            box = Instance.new("SelectionBox", root)
                            box.Adornee = root -- Chỉ bao quanh cái thân
                            box.Color3 = Color3.new(1, 0, 0)
                            box.LineThickness = 0.05
                        end
                    elseif box then
                        box:Destroy()
                    end
                end
            end
        end
    end
end)

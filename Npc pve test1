local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local ESP_Active = false
local Hitbox_Active = false
local Hitbox_Size = 10
local Hitbox_Transparency = 0.8 -- Ch·ªânh 1 n·∫øu mu·ªën t√†ng h√¨nh ho√†n to√†n

local NPC_Config = {
    ["Male"] = { Color = Color3.fromRGB(0, 255, 0) },
    ["Zombie"] = { Color = Color3.fromRGB(255, 0, 0) },
    ["Zombies"] = { Color = Color3.fromRGB(255, 0, 0) }
}

local function IsPlayer(model)
    return Players:GetPlayerFromCharacter(model) ~= nil
end

-- H√†m x·ª≠ l√Ω c∆° ch·∫ø Redirect Hitbox
local function ApplyRedirectHitbox(model)
    if IsPlayer(model) then return end
    local head = model:FindFirstChild("Head")
    if not head or not head:IsA("BasePart") then return end
    local config = NPC_Config[model.Name]

    -- 1. T·∫†O HITBOX PH·ª§ (REDIRECTOR)
    -- Thay v√¨ ph√≥ng to Head th·∫≠t, ta t·∫°o 1 Part t√†ng h√¨nh b√°m theo Head
    local fakeHitbox = head:FindFirstChild("Redirect_Part")
    if Hitbox_Active then
        if not fakeHitbox then
            fakeHitbox = Instance.new("Part")
            fakeHitbox.Name = "Redirect_Part"
            fakeHitbox.Shape = Enum.PartType.Block
            fakeHitbox.CanCollide = false
            fakeHitbox.Massless = true
            fakeHitbox.Anchored = false
            fakeHitbox.CastShadow = false
            
            -- T·∫°o m·ªëi n·ªëi ƒë·ªÉ Part n√†y lu√¥n d√≠nh c·ª©ng v√†o Head
            local weld = Instance.new("WeldConstraint")
            weld.Part0 = head
            weld.Part1 = fakeHitbox
            weld.Parent = fakeHitbox
            
            fakeHitbox.Parent = head
        end
        
        -- C·∫≠p nh·∫≠t th√¥ng s·ªë
        fakeHitbox.Size = Vector3.new(Hitbox_Size, Hitbox_Size, Hitbox_Size)
        fakeHitbox.CFrame = head.CFrame
        fakeHitbox.Transparency = Hitbox_Transparency
        fakeHitbox.Color = config.Color
        fakeHitbox.Material = Enum.Material.ForceField -- Hi·ªáu ·ª©ng ƒë·∫πp n·∫øu kh√¥ng t√†ng h√¨nh
    else
        if fakeHitbox then fakeHitbox:Destroy() end
    end

    -- 2. ESP C·ªê ƒê·ªäNH (Kh√¥ng b·ªã to theo hitbox)
    local esp = head:FindFirstChild("Fixed_ESP")
    if ESP_Active then
        if not esp then
            esp = Instance.new("BoxHandleAdornment")
            esp.Name = "Fixed_ESP"
            esp.AlwaysOnTop = true
            esp.ZIndex = 5
            esp.Transparency = 0.5
            esp.Color3 = config.Color
            esp.Parent = head
        end
        esp.Adornee = head
        esp.Size = Vector3.new(1.5, 1.5, 1.5)
    else
        if esp then esp:Destroy() end
    end
end

-- V√≤ng l·∫∑p c·∫≠p nh·∫≠t
local Connection
Connection = RunService.RenderStepped:Connect(function()
    if not (ESP_Active or Hitbox_Active) then return end
    for _, obj in ipairs(Workspace:GetChildren()) do
        if obj:IsA("Model") and NPC_Config[obj.Name] then
            ApplyRedirectHitbox(obj)
        end
    end
end)

-- // GIAO DI·ªÜN //
local Window = Rayfield:CreateWindow({
    Name = "TOKAI-HUB (REDIRECT)üêß",
    LoadingTitle = "Redirect Hitbox System",
    LoadingSubtitle = "by LONGTOKAI",
    Theme = "Bloom",
    ConfigurationSaving = { Enabled = false }
})

local MainTab = Window:CreateTab("Combat")

MainTab:CreateToggle({
    Name = "Enable Redirect Hitbox",
    CurrentValue = false,
    Callback = function(Value)
        Hitbox_Active = Value
    end,
})

MainTab:CreateSlider({
    Name = "Hitbox Size",
    Min = 1,
    Max = 30,
    Default = 10,
    Color = Color3.fromRGB(255, 50, 50),
    Increment = 1,
    ValueName = "Studs",
    Callback = function(Value)
        Hitbox_Size = Value
    end,
})

MainTab:CreateSlider({
    Name = "Hitbox Visibility",
    Min = 0,
    Max = 1,
    Default = 0.8,
    Increment = 0.1,
    ValueName = "Transparency",
    Callback = function(Value)
        Hitbox_Transparency = Value
    end,
})

local VisualTab = Window:CreateTab("Visuals")

VisualTab:CreateToggle({
    Name = "NPC ESP",
    CurrentValue = false,
    Callback = function(Value)
        ESP_Active = Value
    end,
})

local MiscTab = Window:CreateTab("Misc")

MiscTab:CreateButton({
    Name = "Unload",
    Callback = function()
        Hitbox_Active = false
        ESP_Active = false
        if Connection then Connection:Disconnect() end
        task.wait(0.2)
        Rayfield:Destroy()
    end,
})

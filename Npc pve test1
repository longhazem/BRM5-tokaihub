local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- // BI·∫æN C·∫§U H√åNH //
local Config = {
    ESP_Active = false,
    Hitbox_Active = false,
    Hitbox_Size = 8,
    Wall_Check = true,
    Jitter_Safety = true,
    Target_List = {["Male"] = true, ["Zombie"] = true, ["Zombies"] = true}
}

-- // H√ÄM KI·ªÇM TRA T·∫¶M NH√åN (CH·ªêNG BAN) //
local function IsVisible(part)
    if not Config.Wall_Check then return true end
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {LocalPlayer.Character, part.Parent}
    params.FilterType = Enum.RaycastFilterType.Blacklist
    
    local ray = Workspace:Raycast(Camera.CFrame.Position, (part.Position - Camera.CFrame.Position).Unit * 1000, params)
    return ray == nil
end

-- // QUY TR√åNH X·ª¨ L√ù NPC //
local function ProcessNPC(model)
    local head = model:FindFirstChild("Head")
    if not head then return end

    -- 1. ESP C·ªê ƒê·ªäNH K√çCH TH∆Ø·ªöC (KH√îNG B·ªä TO THEO HITBOX)
    local esp = head:FindFirstChild("Fixed_ESP_Marker")
    if Config.ESP_Active then
        if not esp then
            esp = Instance.new("BoxHandleAdornment")
            esp.Name = "Fixed_ESP_Marker"
            esp.AlwaysOnTop = true
            esp.ZIndex = 10
            esp.Transparency = 0.5
            esp.Color3 = Color3.fromRGB(0, 255, 255)
            esp.Parent = head
        end
        esp.Adornee = head
        -- Kh√≥a k√≠ch th∆∞·ªõc c·ªë ƒë·ªãnh ƒë·ªÉ kh√¥ng b·ªã ·∫£nh h∆∞·ªüng b·ªüi Head.Size
        esp.Size = Vector3.new(1.2, 1.2, 1.2)
    else
        if esp then esp:Destroy() end
    end

    -- 2. MAGIC HITBOX (PART PH·ª§ T√ÄNG H√åNH)
    local magicPart = head:FindFirstChild("Magic_Hitbox_Part")
    local canActivate = Config.Hitbox_Active and IsVisible(head)

    if canActivate then
        if not magicPart then
            magicPart = Instance.new("Part")
            magicPart.Name = "Magic_Hitbox_Part"
            magicPart.Transparency = 1
            magicPart.CanCollide = false
            magicPart.Massless = true
            magicPart.CastShadow = false
            
            local weld = Instance.new("WeldConstraint")
            weld.Part0 = head
            weld.Part1 = magicPart
            weld.Parent = magicPart
            magicPart.Parent = head
        end
        
        -- Dao ƒë·ªông k√≠ch th∆∞·ªõc nh·∫π (Jitter) ƒë·ªÉ ƒë√°nh l·ª´a Anti-cheat
        local jitter = Config.Jitter_Safety and (math.random(-15, 15) / 100) or 0
        local finalSize = Config.Hitbox_Size + jitter
        magicPart.Size = Vector3.new(finalSize, finalSize, finalSize)
    else
        if magicPart then magicPart:Destroy() end
    end
end

-- // V√íNG L·∫∂P H·ªÜ TH·ªêNG //
local MainConnection
MainConnection = RunService.RenderStepped:Connect(function()
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and Config.Target_List[obj.Name] then
            ProcessNPC(obj)
        end
    end
end)

-- // GIAO DI·ªÜN //
local Window = Rayfield:CreateWindow({
    Name = "TOKAI-HUB (FIXED ESP)üõ°Ô∏è",
    LoadingTitle = "NPC Specialist System",
    LoadingSubtitle = "Male | Zombie | Zombies",
    Theme = "Bloom",
    ConfigurationSaving = { Enabled = false }
})

local CombatTab = Window:CreateTab("Combat üî´")

CombatTab:CreateToggle({
    Name = "Magic Hitbox",
    CurrentValue = false,
    Callback = function(Value)
        Config.Hitbox_Active = Value
    end,
})

CombatTab:CreateSlider({
    Name = "Hitbox Radius",
    Min = 1,
    Max = 30,
    Default = 8,
    Increment = 1,
    Callback = function(Value)
        Config.Hitbox_Size = Value
    end,
})

CombatTab:CreateSection("Security")

CombatTab:CreateToggle({
    Name = "Anti-Wall Ban",
    CurrentValue = true,
    Callback = function(Value)
        Config.Wall_Check = Value
    end,
})

CombatTab:CreateToggle({
    Name = "Security Jitter",
    CurrentValue = true,
    Callback = function(Value)
        Config.Jitter_Safety = Value
    end,
})

local VisualTab = Window:CreateTab("Visuals üëÅÔ∏è")

VisualTab:CreateToggle({
    Name = "Fix Size ESP",
    CurrentValue = false,
    Callback = function(Value)
        Config.ESP_Active = Value
    end,
})

local MiscTab = Window:CreateTab("Misc ‚öôÔ∏è")

MiscTab:CreateButton({
    Name = "Unload Script",
    Callback = function()
        Config.ESP_Active = false
        Config.Hitbox_Active = false
        if MainConnection then MainConnection:Disconnect() end
        task.wait(0.2)
        -- D·ªçn d·∫πp Workspace
        for _, obj in ipairs(Workspace:GetDescendants()) do
            if Config.Target_List[obj.Name] then
                local h = obj:FindFirstChild("Head")
                if h then
                    if h:FindFirstChild("Magic_Hitbox_Part") then h.Magic_Hitbox_Part:Destroy() end
                    if h:FindFirstChild("Fixed_ESP_Marker") then h.Fixed_ESP_Marker:Destroy() end
                end
            end
        end
        Rayfield:Destroy()
    end,
})

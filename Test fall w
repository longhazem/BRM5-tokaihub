-- SCRIPT T·∫†O UI K√âO TH·∫¢ V√Ä B·∫¨T/T·∫ÆT NO FALL DAMAGE
-- H∆∞·ªõng d·∫´n: ƒê·∫∑t script n√†y (LocalScript) v√†o StarterPlayerScripts ho·∫∑c StarterGui trong Roblox Studio.

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer

-- Bi·∫øn ki·ªÉm so√°t tr·∫°ng th√°i B·∫≠t/T·∫Øt
local isNoFallEnabled = false
local DANGEROUS_FALL_SPEED = -50 -- Ng∆∞·ª°ng t·ªëc ƒë·ªô r∆°i an to√†n

---------------------------------------------------------
-- 1. T·∫†O GIAO DI·ªÜN (UI) B·∫∞NG SCRIPT
---------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NoFallTestUI"
ScreenGui.ResetOnSpawn = false -- Gi·ªØ UI khi nh√¢n v·∫≠t ch·∫øt

-- Th·ª≠ ƒë∆∞a UI v√†o CoreGui (n·∫øu d√πng exploit), n·∫øu kh√¥ng th√¨ ƒë∆∞a v√†o PlayerGui (Studio)
local success, err = pcall(function()
    ScreenGui.Parent = CoreGui
end)
if not success then
    ScreenGui.Parent = player:WaitForChild("PlayerGui")
end

-- Khung ch√≠nh c·ªßa UI (Main Frame)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 220, 0, 120)
MainFrame.Position = UDim2.new(0.5, -110, 0.5, -60)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

-- Bo g√≥c cho khung ch√≠nh
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- Ti√™u ƒë·ªÅ (Title)
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "Title"
TitleLabel.Size = UDim2.new(1, 0, 0, 35)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "üõ°Ô∏è NO FALL TEST"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = 16
TitleLabel.Parent = MainFrame

-- N√∫t B·∫≠t/T·∫Øt (Toggle Button)
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(0.8, 0, 0, 45)
ToggleButton.Position = UDim2.new(0.1, 0, 0.45, 0)
ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50) -- M√†u ƒë·ªè (T·∫Øt)
ToggleButton.Text = "ƒêANG T·∫ÆT (OFF)"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Font = Enum.Font.GothamBlack
ToggleButton.TextSize = 14
ToggleButton.Parent = MainFrame

-- Bo g√≥c cho n√∫t
local BtnCorner = Instance.new("UICorner")
BtnCorner.CornerRadius = UDim.new(0, 8)
BtnCorner.Parent = ToggleButton

---------------------------------------------------------
-- 2. CH·ª®C NƒÇNG K√âO TH·∫¢ UI (DRAG LOGIC)
---------------------------------------------------------
local dragging = false
local dragInput, mousePos, framePos

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        mousePos = input.Position
        framePos = MainFrame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - mousePos
        MainFrame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
    end
end)

---------------------------------------------------------
-- 3. LOGIC B·∫¨T/T·∫ÆT V√Ä V·∫¨T L√ù NO FALL DAMAGE
---------------------------------------------------------

-- X·ª≠ l√Ω khi b·∫•m n√∫t
ToggleButton.MouseButton1Click:Connect(function()
    isNoFallEnabled = not isNoFallEnabled -- ƒê·∫£o ng∆∞·ª£c tr·∫°ng th√°i
    
    if isNoFallEnabled then
        ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50) -- M√†u xanh l√°
        ToggleButton.Text = "ƒêANG B·∫¨T (ON)"
    else
        ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50) -- M√†u ƒë·ªè
        ToggleButton.Text = "ƒêANG T·∫ÆT (OFF)"
    end
end)

-- V√≤ng l·∫∑p ki·ªÉm tra r∆°i t·ª± do (Ch·ªâ ho·∫°t ƒë·ªông khi isNoFallEnabled = true)
RunService.Stepped:Connect(function()
    if not isNoFallEnabled then return end -- N·∫øu ƒëang t·∫Øt th√¨ kh√¥ng l√†m g√¨ c·∫£
    
    local character = player.Character
    if not character then return end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    
    if humanoidRootPart then
        local currentVelocity = humanoidRootPart.AssemblyLinearVelocity
        
        -- N·∫øu t·ªëc ƒë·ªô r∆°i (tr·ª•c Y) v∆∞·ª£t qu√° ng∆∞·ª°ng cho ph√©p
        if currentVelocity.Y < DANGEROUS_FALL_SPEED then
            -- K√©o v·∫≠n t·ªëc tr·ª•c Y v·ªÅ m·ª©c an to√†n (kh√¥ng b·ªã m·∫•t m√°u)
            humanoidRootPart.AssemblyLinearVelocity = Vector3.new(
                currentVelocity.X, 
                DANGEROUS_FALL_SPEED + 1, 
                currentVelocity.Z
            )
        end
    end
end)
